<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iCloud Photo Album Viewer</title>
  <meta name="description" content="Embed beautiful iCloud shared photo albums in your website with a simple modal script. Responsive, keyboard navigation, dark mode support.">
  <meta name="keywords" content="icloud, photo album, embed, modal, gallery, photos">
  <meta name="author" content="iCloud Photo Album Viewer">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="iCloud Photo Album Viewer">
  <meta property="og:description" content="Embed beautiful iCloud shared photo albums in your website">
  <meta property="og:site_name" content="iCloud Photo Album Viewer">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="iCloud Photo Album Viewer">
  <meta name="twitter:description" content="Embed beautiful iCloud shared photo albums in your website">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f5f5f5;
    }

    @media (prefers-color-scheme: dark) {
      body {
        background: #1a1a1a;
        color: #e0e0e0;
      }
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    header {
      text-align: center;
      margin-bottom: 50px;
    }

    h1 {
      font-size: 36px;
      margin-bottom: 10px;
      color: #1a1a1a;
    }

    @media (prefers-color-scheme: dark) {
      h1 {
        color: #ffffff;
      }
    }

    .subtitle {
      font-size: 18px;
      color: #666;
      margin-bottom: 30px;
    }

    @media (prefers-color-scheme: dark) {
      .subtitle {
        color: #b0b0b0;
      }
    }

    .section {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    @media (prefers-color-scheme: dark) {
      .section {
        background: #2a2a2a;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
    }

    h2 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #1a1a1a;
    }

    @media (prefers-color-scheme: dark) {
      h2 {
        color: #ffffff;
      }
    }

    h3 {
      font-size: 18px;
      margin-top: 25px;
      margin-bottom: 15px;
      color: #333;
    }

    @media (prefers-color-scheme: dark) {
      h3 {
        color: #e0e0e0;
      }
    }

    p {
      margin-bottom: 15px;
      color: #555;
    }

    @media (prefers-color-scheme: dark) {
      p {
        color: #b0b0b0;
      }
    }

    .code-block {
      background: #f8f8f8;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 20px;
      margin: 15px 0;
      overflow-x: auto;
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.5;
    }

    @media (prefers-color-scheme: dark) {
      .code-block {
        background: #1a1a1a;
        border-color: #333;
        color: #e0e0e0;
      }
    }

    code {
      background: rgba(0, 0, 0, 0.05);
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      font-size: 14px;
    }

    @media (prefers-color-scheme: dark) {
      code {
        background: rgba(255, 255, 255, 0.1);
      }
    }

    .code-block code {
      background: none;
      padding: 0;
    }

    .demo-button {
      display: inline-block;
      padding: 12px 24px;
      background: #007AFF;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-size: 16px;
      margin: 10px 10px 10px 0;
      cursor: pointer;
      border: none;
      transition: background 0.2s ease;
    }

    .demo-button:hover {
      background: #0056CC;
    }

    .feature-list {
      list-style: none;
      padding: 0;
    }

    .feature-list li {
      padding: 10px 0;
      padding-left: 30px;
      position: relative;
      color: #555;
    }

    @media (prefers-color-scheme: dark) {
      .feature-list li {
        color: #b0b0b0;
      }
    }

    .feature-list li:before {
      content: "âœ“";
      position: absolute;
      left: 0;
      color: #007AFF;
      font-weight: bold;
    }

    .url-display {
      background: #f0f0f0;
      padding: 12px;
      border-radius: 6px;
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      font-size: 13px;
      word-break: break-all;
      margin: 10px 0;
    }

    @media (prefers-color-scheme: dark) {
      .url-display {
        background: #1a1a1a;
        color: #e0e0e0;
      }
    }

    .url-display a {
      color: #007AFF;
      text-decoration: none;
    }

    .url-display a:hover {
      text-decoration: underline;
    }

    @media (prefers-color-scheme: dark) {
      .url-display a {
        color: #5AC8FA;
      }
    }

    .highlight {
      background: #fff3cd;
      padding: 2px 4px;
      border-radius: 3px;
    }

    @media (prefers-color-scheme: dark) {
      .highlight {
        background: #4a3a00;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>iCloud Photo Album Viewer</h1>
      <p class="subtitle">Embed beautiful iCloud shared photo albums in your website</p>
    </header>

    <section class="section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 30px;">
      <h2 style="color: white; margin-top: 0;">Convert iCloud URL</h2>
      <p style="color: rgba(255,255,255,0.9);">Paste your iCloud shared album URL to generate a shareable link and embed code:</p>
      
      <div style="margin: 20px 0;">
        <input 
          type="text" 
          id="icloud-url-input" 
          placeholder="https://www.icloud.com/sharedalbum/#VbVoD1Zn6V8ctk" 
          style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; font-size: 14px; margin-bottom: 10px; box-sizing: border-box; background: rgba(255,255,255,0.95); color: #333;"
        >
        <button 
          class="demo-button" 
          onclick="convertUrl()"
          style="width: 100%; background: white; color: #667eea;"
        >
          Generate Links
        </button>
      </div>
      
      <div id="url-conversion-result" style="display: none; margin-top: 20px;">
        <div style="background: rgba(255,255,255,0.15); border-radius: 6px; padding: 20px; margin-bottom: 15px;">
          <h3 style="color: white; margin-top: 0;">Shareable Photo Gallery URL</h3>
          <div class="code-block" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3); margin: 10px 0;">
            <code id="viewer-url-display" style="color: white; word-break: break-all;"></code>
          </div>
          <button 
            class="demo-button" 
            onclick="copyViewerUrl(this)"
            style="width: 100%; background: white; color: #667eea; margin-top: 10px;"
          >
            Copy Viewer URL
          </button>
        </div>

        <div style="background: rgba(255,255,255,0.15); border-radius: 6px; padding: 20px; margin-bottom: 15px;">
          <h3 style="color: white; margin-top: 0;">Vlog Feed URL</h3>
          <div class="code-block" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3); margin: 10px 0;">
            <code id="feed-url-display" style="color: white; word-break: break-all;"></code>
          </div>
          <button 
            class="demo-button" 
            onclick="copyFeedUrl(this)"
            style="width: 100%; background: white; color: #667eea; margin-top: 10px;"
          >
            Copy Feed URL
          </button>
        </div>

        <div style="background: rgba(255,255,255,0.15); border-radius: 6px; padding: 20px; margin-bottom: 15px;">
          <h3 style="color: white; margin-top: 0;">Modal Embed Code</h3>
          <div class="code-block" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3); margin: 10px 0; max-height: 200px; overflow-y: auto;">
            <code id="embed-code-display" style="color: white; white-space: pre-wrap; word-break: break-all;"></code>
          </div>
          <button 
            class="demo-button" 
            onclick="copyEmbedCode(this)"
            style="width: 100%; background: white; color: #667eea; margin-top: 10px;"
          >
            Copy Embed Code
          </button>
        </div>
      </div>
    </section>

    <section class="section">
      <h2>Quick Start</h2>
      <p>Add this script to your HTML page:</p>
      <div class="code-block" id="script-tag"></div>
      
      <p>Then use it in your code:</p>
      <div class="code-block">
<code>&lt;button onclick="icloudAlbumModal('YOUR_ALBUM_TOKEN')"&gt;View Photos&lt;/button&gt;</code>
      </div>

      <button class="demo-button" onclick="demoModal()">Try Demo</button>
    </section>

    <section class="section">
      <h2>Features</h2>
      <ul class="feature-list">
        <li>Full-screen modal overlay with smooth animations</li>
        <li>Responsive grid view with hover effects</li>
        <li>Full-screen lightbox for viewing individual photos and videos</li>
        <li>Keyboard navigation (arrow keys, ESC)</li>
        <li>Touch/swipe support (swipe down to dismiss)</li>
        <li>Dark mode support (follows system preferences)</li>
        <li>Isolated styles (won't conflict with your page)</li>
        <li>Smart caching with instant thumbnail preview</li>
        <li>Privacy-focused: EXIF location data automatically stripped</li>
        <li>Optimized images for fast loading</li>
      </ul>
    </section>

    <section class="section">
      <h2>How It Works</h2>
      <p>The modal script creates a full-screen overlay with an iframe that loads your album viewer. The album viewer fetches photos from iCloud and displays them in a beautiful, responsive interface.</p>
      
      <p><strong>Album Token:</strong> To get an album token, share an iCloud photo album and extract the token from the share URL. The token is the unique identifier in the URL.</p>
      
      <p><strong>Encrypted Tokens:</strong> Encrypted tokens start with <code>e-</code> and hide the original album token. The backend automatically decrypts them when used. Use the token encryption tool above to convert public tokens to private ones.</p>
      
      <p><strong>Privacy & Security:</strong> All images are proxied through the server with EXIF location data automatically stripped. Original iCloud URLs are never exposed to clients. Images are optimized for web display (resized and compressed) for faster loading.</p>
      
      <p><strong>Video Support:</strong> The viewer supports both photos and videos from iCloud shared albums. Videos can be automatically transcribed and converted to blog posts using AI.</p>
      
      <p><strong>Feed View:</strong> Albums can be viewed in a blog-style feed format at <code>/feed/:token</code>. This view is ideal for mixed photo/video albums, where videos are displayed as blog posts with automatic transcription and AI-generated content. Photos appear in a responsive grid interspersed with the video posts.</p>
    </section>

    <section class="section">
      <h2>Usage Examples</h2>
      
      <h3>As a Button</h3>
      <div class="code-block">
<code>&lt;button onclick="icloudAlbumModal('e-dc429eb14883381124c7697c5f08dca63e3cddba76503acfc102ceb301d582471113fa4b8e561a9e8fa2bf307e2c7992qShPYILQiYdqLvmj2QTtrVGQm+tczGyFqTpz2rIwQlg=')"&gt;
  View Photos
&lt;/button&gt;</code>
      </div>

      <h3>As a Link</h3>
      <div class="code-block">
<code>&lt;a href="#" onclick="icloudAlbumModal('e-dc429eb14883381124c7697c5f08dca63e3cddba76503acfc102ceb301d582471113fa4b8e561a9e8fa2bf307e2c7992qShPYILQiYdqLvmj2QTtrVGQm+tczGyFqTpz2rIwQlg='); return false;"&gt;
  View Photos
&lt;/a&gt;</code>
      </div>

      <h3>Programmatically</h3>
      <div class="code-block">
<code>&lt;script&gt;
  // Open modal programmatically
  icloudAlbumModal('e-dc429eb14883381124c7697c5f08dca63e3cddba76503acfc102ceb301d582471113fa4b8e561a9e8fa2bf307e2c7992qShPYILQiYdqLvmj2QTtrVGQm+tczGyFqTpz2rIwQlg=');
&lt;/script&gt;</code>
      </div>
    </section>

    <section class="section">
      <h2>API Endpoints</h2>
      
      <h3>View Album</h3>
      <p>Access albums directly via URL (grid view):</p>
      <div class="url-display" id="album-url"></div>

      <h3>Feed View</h3>
      <p>View albums in a blog-style feed format (ideal for mixed photo/video albums with transcriptions):</p>
      <div class="url-display" id="feed-url"></div>

      <h3>Fetch Album Data</h3>
      <p>Get album data as JSON (supports encrypted tokens with <code>e-</code> prefix):</p>
      <div class="url-display" id="api-url"></div>
      
      <h3>Encrypt Token</h3>
      <p>Convert a public token to an encrypted private token:</p>
      <div class="url-display" id="api-encrypt-url"></div>
    </section>

    <section class="section">
      <h2>Token Encryption</h2>
      <p>Convert a public album token to an encrypted private token for added security:</p>
      
      <div style="margin: 20px 0;">
        <input 
          type="text" 
          id="token-input" 
          placeholder="Enter album token (e.g. VbVoD1ZWv+u1Ybn6V8ctk)" 
          style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; margin-bottom: 10px; box-sizing: border-box;"
        >
        <button 
          class="demo-button" 
          onclick="encryptToken()"
          style="width: 100%;"
        >
          Encrypt Token
        </button>
      </div>
      
      <div id="encrypted-result" style="display: none; margin-top: 15px;">
        <p><strong>Encrypted Token:</strong></p>
        <div class="code-block" id="encrypted-token-display"></div>
        <button 
          class="demo-button" 
          onclick="copyEncryptedToken()"
          style="margin-top: 10px;"
        >
          Copy Encrypted Token
        </button>
      </div>
    </section>
  </div>

  <script>
    // Build URLs based on current hostname and protocol
    const baseUrl = window.location.origin;
    const scriptUrl = `${baseUrl}/icloud-photo-album-modal.js`;
    const exampleToken = 'e-dc429eb14883381124c7697c5f08dca63e3cddba76503acfc102ceb301d582471113fa4b8e561a9e8fa2bf307e2c7992qShPYILQiYdqLvmj2QTtrVGQm+tczGyFqTpz2rIwQlg=';

    // Update script tag
    document.getElementById('script-tag').innerHTML = `<code>&lt;script src="${scriptUrl}"&gt;&lt;/script&gt;</code>`;

    // Update API URLs (make them clickable)
    const albumUrl = `${baseUrl}/${exampleToken}`;
    const feedUrl = `${baseUrl}/feed/${exampleToken}`;
    const apiUrl = `${baseUrl}/api/album/${exampleToken}`;
    const encryptUrl = `${baseUrl}/api/encrypt-token`;
    
    document.getElementById('album-url').innerHTML = `<a href="${albumUrl}" target="_blank" rel="noopener noreferrer">${albumUrl}</a>`;
    document.getElementById('feed-url').innerHTML = `<a href="${feedUrl}" target="_blank" rel="noopener noreferrer">${feedUrl}</a>`;
    document.getElementById('api-url').innerHTML = `<a href="${apiUrl}" target="_blank" rel="noopener noreferrer">${apiUrl}</a>`;
    document.getElementById('api-encrypt-url').innerHTML = `<a href="${encryptUrl}" target="_blank" rel="noopener noreferrer">POST ${encryptUrl}</a>`;

    // Demo function
    function demoModal() {
      if (typeof icloudAlbumModal === 'function') {
        icloudAlbumModal(exampleToken);
      } else {
        // Load script if not already loaded
        const script = document.createElement('script');
        script.src = scriptUrl;
        script.onload = () => {
          icloudAlbumModal(exampleToken);
        };
        document.head.appendChild(script);
      }
    }

    // Encrypt token function
    let encryptedTokenValue = '';
    
    async function encryptToken() {
      const input = document.getElementById('token-input');
      const token = input.value.trim();
      
      if (!token) {
        alert('Please enter an album token');
        return;
      }

      try {
        const response = await fetch(`${baseUrl}/api/encrypt-token`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ token }),
        });

        if (!response.ok) {
          throw new Error('Failed to encrypt token');
        }

        const data = await response.json();
        encryptedTokenValue = data.encryptedToken;
        
        document.getElementById('encrypted-token-display').innerHTML = `<code>${data.encryptedToken}</code>`;
        document.getElementById('encrypted-result').style.display = 'block';
      } catch (error) {
        alert('Error encrypting token: ' + error.message);
      }
    }

    function copyEncryptedToken() {
      if (encryptedTokenValue) {
        navigator.clipboard.writeText(encryptedTokenValue).then(() => {
          alert('Encrypted token copied to clipboard!');
        }).catch(() => {
          alert('Failed to copy token');
        });
      }
    }

    // URL conversion functions
    let currentViewerUrl = '';
    let currentFeedUrl = '';
    let currentEmbedCode = '';
    let currentToken = '';

    function extractToken(url) {
      if (!url) return null;
      
      // Try to extract token from various URL formats
      // https://www.icloud.com/sharedalbum/#B1v532ODWVjCzg
      const hashMatch = url.match(/#([^?&#]+)/);
      if (hashMatch) {
        return hashMatch[1];
      }
      
      // Try query parameter
      const queryMatch = url.match(/[?&]token=([^&#]+)/);
      if (queryMatch) {
        return queryMatch[1];
      }
      
      // If it's just a token, return it
      if (!url.includes('http') && !url.includes('/')) {
        return url.trim();
      }
      
      return null;
    }

    async function convertUrl() {
      const input = document.getElementById('icloud-url-input');
      const url = input.value.trim();
      
      if (!url) {
        alert('Please enter an iCloud shared album URL');
        return;
      }

      const token = extractToken(url);
      if (!token) {
        alert('Could not extract album token from URL. Please make sure it\'s a valid iCloud shared album URL.');
        return;
      }

      // Encrypt the token
      let encryptedToken = token;
      try {
        const response = await fetch(`${baseUrl}/api/encrypt-token`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ token }),
        });

        if (response.ok) {
          const data = await response.json();
          encryptedToken = data.encryptedToken;
        } else {
          console.warn('Failed to encrypt token, using unencrypted token');
        }
      } catch (error) {
        console.error('Error encrypting token:', error);
        // Continue with unencrypted token
      }

      currentToken = encryptedToken;
      currentViewerUrl = `${baseUrl}/${encryptedToken}`;
      currentFeedUrl = `${baseUrl}/feed/${encryptedToken}`;
      const scriptTag = '<script src="' + scriptUrl + '"><\/script>';
      const buttonTag = '<button onclick="icloudAlbumModal(\'' + encryptedToken + '\')">View Photos</button>';
      currentEmbedCode = scriptTag + '\n' + buttonTag;

      document.getElementById('viewer-url-display').textContent = currentViewerUrl;
      document.getElementById('feed-url-display').textContent = currentFeedUrl;
      document.getElementById('embed-code-display').textContent = currentEmbedCode;
      document.getElementById('url-conversion-result').style.display = 'block';
      
      // Scroll to result
      document.getElementById('url-conversion-result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function copyViewerUrl(btn) {
      if (!currentViewerUrl) return;
      
      const originalText = btn.textContent;
      navigator.clipboard.writeText(currentViewerUrl).then(() => {
        btn.textContent = 'Copied!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      }).catch((err) => {
        console.error('Failed to copy URL:', err);
        alert('Failed to copy URL');
      });
    }

    function copyFeedUrl(btn) {
      if (!currentFeedUrl) return;
      
      const originalText = btn.textContent;
      navigator.clipboard.writeText(currentFeedUrl).then(() => {
        btn.textContent = 'Copied!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      }).catch((err) => {
        console.error('Failed to copy feed URL:', err);
        alert('Failed to copy feed URL');
      });
    }

    function copyEmbedCode(btn) {
      if (!currentEmbedCode) return;
      
      const originalText = btn.textContent;
      navigator.clipboard.writeText(currentEmbedCode).then(() => {
        btn.textContent = 'Copied!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      }).catch((err) => {
        console.error('Failed to copy embed code:', err);
        alert('Failed to copy embed code');
      });
    }

    // Allow Enter key to trigger conversion
    document.addEventListener('DOMContentLoaded', () => {
      const urlInput = document.getElementById('icloud-url-input');
      if (urlInput) {
        urlInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            convertUrl();
          }
        });
      }
    });
  </script>
  <script src="icloud-photo-album-modal.js"></script>
</body>
</html>

